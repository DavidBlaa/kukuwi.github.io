import{a as S,t as M,c as xe}from"./disclose-version.BlfRRn3x.js";import{ad as be,p as re,Z as C,x as u,r as c,a as ne,c as l,s as y,ab as _,z as de,aa as h,n as ye,ao as ie,f as ge}from"./runtime.BZDbob96.js";import{f as J}from"./events.CQ-CDWS2.js";import{i as oe}from"./if.DhnByTD-.js";import{e as ue,i as ce}from"./each.CaWgedCa.js";import{p as w,a as F,u as he}from"./props.BH0R1WOI.js";import{o as we}from"./index-client.CBR9gwgh.js";import{b as Z}from"./paths.jZZZWFxg.js";import{s as q}from"./class.CbU5o3FF.js";import{i as te,a as Ie,b as le}from"./instruments.DCVs4qqt.js";import{s as H}from"./render.DhTGtpIM.js";import{s as W}from"./attributes.wvbF4nki.js";import{I as ke,F as Ue}from"./Icon.f-8mEN14.js";function Se(r,t,n,a,i){var o=()=>{a(n[r])};n.addEventListener(t,o),o(),(n===document.body||n===window||n===document)&&be(()=>{n.removeEventListener(t,o)})}function Me(r){var t=new b(r),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var a=Pe(n.data),i=[],o=0;!t.eof()&&o<a.numTracks;o++){var e=t.readChunk();if(e.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+e.id+"'";var d=Te(e.data);i.push(d)}return{header:a,tracks:i}}function Pe(r){var t=new b(r),n=t.readUInt16(),a=t.readUInt16(),i={format:n,numTracks:a},o=t.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function Te(r){for(var t=new b(r),n=[];!t.eof();){var a=o();n.push(a)}return n;var i;function o(){var e={};e.deltaTime=t.readVarInt();var d=t.readUInt8();if((d&240)===240)if(d===255){e.meta=!0;var f=t.readUInt8(),s=t.readVarInt();switch(f){case 0:if(e.type="sequenceNumber",s!==2)throw"Expected length for sequenceNumber event is 2, got "+s;return e.number=t.readUInt16(),e;case 1:return e.type="text",e.text=t.readString(s),e;case 2:return e.type="copyrightNotice",e.text=t.readString(s),e;case 3:return e.type="trackName",e.text=t.readString(s),e;case 4:return e.type="instrumentName",e.text=t.readString(s),e;case 5:return e.type="lyrics",e.text=t.readString(s),e;case 6:return e.type="marker",e.text=t.readString(s),e;case 7:return e.type="cuePoint",e.text=t.readString(s),e;case 32:if(e.type="channelPrefix",s!=1)throw"Expected length for channelPrefix event is 1, got "+s;return e.channel=t.readUInt8(),e;case 33:if(e.type="portPrefix",s!=1)throw"Expected length for portPrefix event is 1, got "+s;return e.port=t.readUInt8(),e;case 47:if(e.type="endOfTrack",s!=0)throw"Expected length for endOfTrack event is 0, got "+s;return e;case 81:if(e.type="setTempo",s!=3)throw"Expected length for setTempo event is 3, got "+s;return e.microsecondsPerBeat=t.readUInt24(),e;case 84:if(e.type="smpteOffset",s!=5)throw"Expected length for smpteOffset event is 5, got "+s;var p=t.readUInt8(),I={0:24,32:25,64:29,96:30};return e.frameRate=I[p&96],e.hour=p&31,e.min=t.readUInt8(),e.sec=t.readUInt8(),e.frame=t.readUInt8(),e.subFrame=t.readUInt8(),e;case 88:if(e.type="timeSignature",s!=2&&s!=4)throw"Expected length for timeSignature event is 4 or 2, got "+s;return e.numerator=t.readUInt8(),e.denominator=1<<t.readUInt8(),s===4?(e.metronome=t.readUInt8(),e.thirtyseconds=t.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",s!=2)throw"Expected length for keySignature event is 2, got "+s;return e.key=t.readInt8(),e.scale=t.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=t.readBytes(s),e;default:return e.type="unknownMeta",e.data=t.readBytes(s),e.metatypeByte=f,e}}else if(d==240){e.type="sysEx";var s=t.readVarInt();return e.data=t.readBytes(s),e}else if(d==247){e.type="endSysEx";var s=t.readVarInt();return e.data=t.readBytes(s),e}else throw"Unrecognised MIDI event type byte: "+d;else{var m;if(d&128)m=t.readUInt8(),i=d;else{if(i===null)throw"Running status byte encountered before status byte";m=d,d=i,e.running=!0}var P=d>>4;switch(e.channel=d&15,P){case 8:return e.type="noteOff",e.noteNumber=m,e.velocity=t.readUInt8(),e;case 9:var U=t.readUInt8();return e.type=U===0?"noteOff":"noteOn",e.noteNumber=m,e.velocity=U,U===0&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=m,e.amount=t.readUInt8(),e;case 11:return e.type="controller",e.controllerType=m,e.value=t.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=m,e;case 13:return e.type="channelAftertouch",e.amount=m,e;case 14:return e.type="pitchBend",e.value=m+(t.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+P}}}}function b(r){this.buffer=r,this.bufferLen=this.buffer.length,this.pos=0}b.prototype.eof=function(){return this.pos>=this.bufferLen};b.prototype.readUInt8=function(){var r=this.buffer[this.pos];return this.pos+=1,r};b.prototype.readInt8=function(){var r=this.readUInt8();return r&128?r-256:r};b.prototype.readUInt16=function(){var r=this.readUInt8(),t=this.readUInt8();return(r<<8)+t};b.prototype.readInt16=function(){var r=this.readUInt16();return r&32768?r-65536:r};b.prototype.readUInt24=function(){var r=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(r<<16)+(t<<8)+n};b.prototype.readInt24=function(){var r=this.readUInt24();return r&8388608?r-16777216:r};b.prototype.readUInt32=function(){var r=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),a=this.readUInt8();return(r<<24)+(t<<16)+(n<<8)+a};b.prototype.readBytes=function(r){var t=this.buffer.slice(this.pos,this.pos+r);return this.pos+=r,t};b.prototype.readString=function(r){var t=this.readBytes(r);return String.fromCharCode.apply(null,t)};b.prototype.readVarInt=function(){for(var r=0;!this.eof();){var t=this.readUInt8();if(t&128)r+=t&127,r<<=7;else return r+t}return r};b.prototype.readChunk=function(){var r=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:r,length:t,data:n}};var Be=Me,Ee=Be,Fe=M("<div></div>"),Ce=M("<button></button>");function je(r,t){re(t,!0);let n=w(t,"active",11,!1);const a=F([]);for(const[o,e]of t.pattern_array.entries())e?o%16<=3||8<=o%16&&o%16<=11?a.push("bg-green-600"):a.push("bg-green-700"):o%16<=3||8<=o%16&&o%16<=11?a.push("bg-gray-300"):a.push("bg-gray-400");var i=Ce();i.__mouseup=function(...o){var e;(e=t.onmouseup)==null||e.apply(this,o)},ue(i,21,()=>a,ce,(o,e)=>{var d=Fe();C(()=>q(d,`h-full ${u(e)??""} border border-black`)),S(o,d)}),c(i),C(()=>q(i,` grid h-full w-full grid-cols-16 flex-row border-4 ${(n()?"border-blue-600 shadow-2xl shadow-blue-600 ":"border-gray-500")??""} rounded`)),S(r,i),ne()}J(["mouseup"]);const Ge=[{midi_src:"2_Custom2.mid",audio_src:"2_Custom2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Custom3.mid",audio_src:"2_Custom3.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro1.mid",audio_src:"2_Elektro 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro2.mid",audio_src:"2_Elektro 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop1.mid",audio_src:"2_Hip Hop 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop2.mid",audio_src:"2_Hip Hop 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_1.mid",audio_src:"2_Techno 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_2.mid",audio_src:"2_Techno 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"3_AmenBreaks.mid",audio_src:"3_Amen Breaks.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Custom1.mid",audio_src:"3_Custom 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rock1.mid",audio_src:"3_Rock 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rumba.mid",audio_src:"3_Rumba.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SiberianNights.mid",audio_src:"3_Siberian Nights.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SonClave.mid",audio_src:"3_Son Clave.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_FunkyDrummer.mid",audio_src:"4_Funky Drummer.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_House1.mid",audio_src:"4_House 1.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_House2.mid",audio_src:"4_House 2.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_Rock2.mid",audio_src:"4_Rock 2.wav",instrument_type:"drum",n_instruments:4}],Ne=["success1.gif","success2.gif","success3.gif","success4.gif","success5.gif","gil-cat.gif","happy-snoopy.gif"],He=["fail1.gif","fail2.gif","fail3.gif","fail4.gif"];function _t(r,t){let n=[];if(t){const a=Re(te).filter(o=>o.count>=r);if(a.length===0)throw Error(`Could not find a category with at least ${r} instruments.`);const i=a[Math.floor(Math.random()*a.length)];n=te.filter(o=>o.category===i.name)}else n=te;return n=De(n).slice(0,r),n.map((a,i)=>({index:i,name:a.name,category:a.category,image:a.image,audio:a.audios[Math.floor(Math.random()*a.audios.length)]}))}function Re(r){const t=new Map;return r.forEach(n=>{t.set(n.category,(t.get(n.category)??0)+1)}),Array.from(t,([n,a])=>({name:n,count:a}))}function De(r){for(let t=r.length;t>0;t--){const n=Math.floor(Math.random()*t);[r[t-1],r[n]]=[r[n],r[t-1]]}return r}function pt(r){return r[Math.floor(Math.random()*r.length)]}function Ae(r){const t=r?Ne:He;return t[Math.floor(Math.random()*t.length)]}function fe(r){return r!=null?parseInt(""+Math.random()*r.length):-1}function Oe(r,t){const n=[],a=[];do{const i=fe(r);n.includes(i)||(n.push(i),a.push(r[i]))}while(a.length<t);return a}var Ve=M(`<div><div><div class="flex h-5/6 w-5/6 flex-row items-center justify-center rounded-full bg-gray-800


            "><div class="flex h-5/6 w-5/6 flex-row items-center justify-center rounded-full border-b-2
                            border-l-2 border-r-2
                            border-t-2 border-b-gray-300
                            border-l-gray-800 border-r-gray-800
                            border-t-gray-300 bg-gray-800"><div class="flex h-5/6 w-5/6 flex-row items-center justify-center rounded-full border-b-2
                            border-l-2 border-r-2
                            border-t-2 border-b-gray-300
                            border-l-gray-800 border-r-gray-800
                            border-t-gray-300 bg-gray-800"><div class="flex h-5/6 w-5/6 flex-row items-center justify-center rounded-full border-b-2
                            border-l-2 border-r-2
                            border-t-2 border-b-gray-300
                            border-l-gray-800 border-r-gray-800
                            border-t-gray-300 bg-gray-800"><div class="flex h-4/6 w-4/6 flex-row items-center justify-center rounded-full bg-red-800"><div class="flex h-1/6 w-1/6 flex-row items-center justify-center rounded-full bg-white"></div></div></div></div></div></div></div></div>`);function Le(r,t){let n=w(t,"spinning",3,!1),a=w(t,"height",3,"h-min-1/10 h-full");var i=Ve(),o=l(i);c(i),C(()=>{q(i,`flex flex-row items-center justify-center ${a()??""}`),q(o,`flex h-full w-full flex-row items-center justify-center rounded-full bg-gray-600 ${(n()?"animate-spin-slow":"")??""}`)}),S(r,i)}var ze=M('<div class="grid grid-cols-2 border-2 border-gray-500 bg-blue-200 text-xs lg:text-2xl"><span class="border-2 border-gray-500 p-1">Geh√∂rt</span> <span class="items-center border-2 border-gray-500 p-1"> </span> <span class="border-2 border-gray-500 p-1">Versuche</span> <span class="items-center border-2 border-gray-500 p-1"> </span> <span class="border-2 border-gray-500 p-1">Zeit</span> <span class="items-center border-2 border-gray-500 p-1"> </span></div>');function Ze(r,t){let n=w(t,"time",11,0),a=w(t,"tries",11,0),i=w(t,"repeats",11,0);var o=ze(),e=y(l(o),2),d=l(e,!0);c(e);var f=y(e,4),s=l(f,!0);c(f);var p=y(f,4),I=l(p,!0);c(p),c(o),C(()=>{H(d,i()),H(s,a()),H(I,n())}),S(r,o)}var qe=(r,t)=>t(),Ke=M(`<div class="flex h-full w-full flex-col items-center justify-evenly"><div class="h-52 w-52 max-lg:hidden"><!></div> <div class="flex flex-row items-stretch justify-evenly"><span class="ml-1 h-fit w-full border-4 border-gray-500 bg-green-500 p-1 text-xl font-bold text-white"> </span> <span class="h-fit w-full border-4 border-gray-500 bg-green-500 p-1 text-xl font-bold text-white"> </span></div> <div><!></div> <button class="
            flex
            h-1/6
            w-5/6
            cursor-pointer
            select-none
            flex-col
            justify-center
            rounded-lg
            border-[1px]
            bg-blue-400 p-3
            transition-all
            duration-150 [box-shadow:0_8px_0_0_#477aba,0_13px_0_0_#1b70f841] active:translate-y-2
            active:border-b-[0px]
            active:[box-shadow:0_0px_0_0_#1b6ff8,0_0px_0_0_#1b70f841]
        "><!></button> <audio></audio></div>`);function Qe(r,t){let n=w(t,"volume",3,.5),a=w(t,"trackPaused",15,!0),i=w(t,"time",7,0),o=w(t,"tries",7,0),e=w(t,"repeats",7,0),d=h(0),f=h(0);function s(){_(f,0),a(!1),he(e)}function p(x){if(isNaN(x))return"...";const V=Math.floor(x/60),L=Math.floor(x%60);return`${V}:${L<10?`0${L}`:L}`}var I=Ke(),m=l(I),P=l(m),U=de(()=>!a());Le(P,{get spinning(){return u(U)}}),c(m);var D=y(m,2),A=l(D),X=l(A,!0);C(()=>H(X,p(u(f)))),c(A);var K=y(A,2),Y=l(K,!0);C(()=>H(Y,p(u(d)))),c(K),c(D);var j=y(D,2),O=l(j);Ze(O,{get time(){return i()},set time(x){i(x)},get repeats(){return e()},set repeats(x){e(x)},get tries(){return o()},set tries(x){o(x)}}),c(j);var T=y(j,2);T.__click=[qe,s];var $=l(T);ke($,{size:"100%",color:"white",src:Ue}),c(T);var G=y(T,2);c(I),C(()=>{W(G,"src",t.trackSource),G.volume=n()}),Ie(G,()=>u(f),x=>_(f,x)),Se("duration","durationchange",G,x=>_(d,x)),le(G,a),S(r,I)}J(["click"]);var We=M(`<div class="fixed bottom-0 top-0 h-screen w-screen flex-col items-center justify-start"><div class="fixed bottom-0 top-0 z-50 flex h-full w-full flex-col items-center justify-start p-7"><img> <button class="
							mt-3
							flex
							h-1/6
							w-fit
							cursor-pointer
							select-none
							flex-col
							justify-center
							rounded-lg
							border-[1px] bg-amber-500
							px-7
							py-2 text-3xl font-extrabold
							transition-all
							duration-150
							[box-shadow:0_8px_0_0_#d1870a,0_13px_0_0_#1b70f841]
							active:translate-y-2
							active:border-b-[0px]
							active:[box-shadow:0_0px_0_0_#d1870a,0_0px_0_0_#1b70f841]
					"> <br> </button> <audio></audio></div> <div class="z-15 fixed bottom-0 top-0 flex h-screen w-screen flex-col items-center justify-center bg-gray-500 opacity-80"></div></div>`);function Je(r,t){re(t,!0);let n=w(t,"success",11,!0),a=w(t,"gifSoundPaused",15,!0),i=Ae(n()),o=n()?Z+"/audios/gif-sounds/success-fanfare-trumpets-6185.mp3":Z+"/audios/gif-sounds/trumpet-fail-242645.mp3";var e=We(),d=l(e),f=l(d);W(f,"src",Z+"/gifs/"+i);var s=y(f,2);s.__click=function(...P){var U;(U=t.onclick)==null||U.apply(this,P)};var p=l(s),I=y(p,2);c(s);var m=y(s,2);W(m,"src",o),c(d),ye(2),c(e),C(()=>{q(f,`h-5/6 ${(n()?"border-green-800":"border-red-600")??""} border-8 shadow-2xl`),W(f,"alt",n()?"Gewonnen!!!":"Verloren :("),H(p,`${(n()?"RICHTIG :)":"FALSCH :(")??""} `),H(I,` ${(n()?t.GIFButtonTextSuccess:t.GIFButtonTextFailure)??""}`),m.volume=t.volume}),le(m,a),S(r,e),ne()}J(["click"]);const Xe=[{difficulty:"einfach",rows:2},{difficulty:"mittel",rows:3},{difficulty:"schwer",rows:4}];var Ye=M('<div class="h-full w-full basis-1/6"><!></div>'),$e=(r,t)=>t(),et=M('<div class="absolute left-0 top-0"><!></div>'),tt=M(`<div class="flex h-full w-full flex-col items-center justify-center bg-blue-300"><div class="bg-s h-11/12 border-12 ml-2 flex w-11/12 flex-row justify-evenly rounded-2xl border-8 bg-gray-600 p-5"><div class="flex basis-9/12 flex-col items-center justify-evenly"><!></div> <div class="flex basis-1/6 flex-col items-center"><div class="h-5/6"><!></div> <button class="
            		mt-3
            		flex
           			h-fit
					w-10/12
					cursor-pointer
					select-none
					flex-col
					justify-center
					rounded-lg
					border-[1px]
					bg-amber-500 p-3
					text-3xl
					transition-all duration-150 [box-shadow:0_8px_0_0_#cf860a,0_13px_0_0_#1b70f841]
					active:translate-y-2
					active:border-b-[0px]
					active:[box-shadow:0_0px_0_0_#1b6ff8,0_0px_0_0_#1b70f841]
				">Raten</button></div></div> <!></div>`);function xt(r,t){re(t,!0);const n=F([]);let a=h(0),i=h(-1),o=h(!1),e=h("4_Rock 2.wav"),d=h(!1),f=h(!0),s=h(!1),p=h(!1),I=h(0),m=h(!0),P=0,U=h(0);const D=async(v,g)=>{const k=await(await fetch(Z+"/midis/"+v)).arrayBuffer(),E=new Uint8Array(k),ae=Ee(E),z=24,R={},Q=[];let se=0;for(const N of ae.tracks[0])se+=N.deltaTime,N.type==="noteOn"&&(N.noteNumber in R||(R[N.noteNumber]=[]),R[N.noteNumber].push(se));for(const[,N]of Object.entries(R))for(let ee=0;ee<16;ee++)Q.push(N.includes(ee*z));n.push({pattern:Q,selected:!1,index:g})};we(()=>{const v="drum",g=Xe[t.difficulty-1].rows,B=Oe(Ge.filter(k=>k.instrument_type===v&&k.n_instruments===g),3);_(a,F(fe(B))),_(e,F(B[u(a)].audio_src));for(const[k,E]of B.entries())D(E.midi_src,k);_(o,!0),Y(),_(f,!1),ie(U)});function A(v){u(i)!=v&&(_(i,F(v)),n.forEach(g=>{g.selected=g.index===v}))}function X(){_(p,u(a)===u(i)),_(m,!1),_(f,!0),_(d,!0),_(s,!1)}function K(){const v=u(p)?1e3:0;t.handleNextRound(v),_(d,!1)}function Y(){setInterval(()=>{u(m)&&ie(I)},1e3)}var j=tt(),O=l(j),T=l(O),$=l(T);{var G=v=>{var g=xe(),B=ge(g);ue(B,17,()=>n,ce,(k,E,ae)=>{var z=Ye(),R=l(z);je(R,{get pattern_array(){return u(E).pattern},onmouseup:()=>A(u(E).index),get active(){return u(E).selected},set active(Q){u(E).selected=Q}}),c(z),S(k,z)}),S(v,g)};oe($,v=>{u(o)&&v(G)})}c(T);var x=y(T,2),V=l(x),L=l(V),me=de(()=>Z+"/audios/pattern_sounds/"+u(e));Qe(L,{get repeats(){return u(U)},get time(){return u(I)},get trackSource(){return u(me)},get tries(){return P},get volume(){return t.volume},get trackPaused(){return u(f)},set trackPaused(v){_(f,F(v))}}),c(V);var ve=y(V,2);ve.__mousedown=[$e,X],c(x),c(O);var _e=y(O,2);{var pe=v=>{var g=et(),B=l(g);Je(B,{onclick:K,get GIFButtonTextSuccess(){return t.GIFButtonTextSuccess},get GIFButtonTextFailure(){return t.GIFButtonTextFailure},get volume(){return t.volume},get success(){return u(p)},set success(k){_(p,F(k))},get gifSoundPaused(){return u(s)},set gifSoundPaused(k){_(s,F(k))}}),c(g),S(v,g)};oe(_e,v=>{u(d)&&v(pe)})}c(j),S(r,j),ne()}J(["mousedown"]);export{Je as G,Qe as M,xt as P,_t as g,pt as s};
